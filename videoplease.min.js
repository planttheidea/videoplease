/*
 *
 * Copyright 2014 Tony Quetano under the terms of the MIT
 * license found at https://github.com/planttheidea/bolster/MIT_License.txt
 *
 * videoplease.js - A plugin to generate bulletproof video that works back to IE8
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
*/
(function(x,p){function s(a,c){var b=c||{},f=h.video.cloneNode(!1),n=h.source.cloneNode(!1),q=h.source.cloneNode(!1),r=h.source.cloneNode(!1),s=h.object.cloneNode(!1),v=h.param.cloneNode(!1),w=h.param.cloneNode(!1),x=h.param.cloneNode(!1);h.param.cloneNode(!1);var D=p.querySelectorAll(a);f.canPlayType||(f.style.display="block");f.className="VideoPlease";this.length=0;this.elements=[];this.players=[];this.isActive=[];for(var d=0;d<D.length;d++){var e=f.cloneNode(!0),t=n.cloneNode(!1),y=q.cloneNode(!1),
z=r.cloneNode(!1),k=s.cloneNode(!1),A=v.cloneNode(!1),B=w.cloneNode(!1),C=x.cloneNode(!1);if(c){e.setAttribute("data-index",d);e.className+=" VideoPlease"+d;e.setAttribute("preload",b.preload||u.preload);e.setAttribute("controls",b.controls||u.controls);g({target:e,name:"preload",value:b.preload,index:d});g({target:e,name:"autoplay",value:b.autoplay,index:d});g({target:e,name:"id",value:b.id,index:d});g({target:e,name:"width",value:b.width,index:d});g({target:e,name:"height",value:b.height,index:d});
b.className&&("array"===l(b.className)?m(b.className[d])||(e.className+=b.className[d]):e.className+=b.className);g({target:e,name:"poster",value:b.poster,index:d});g({target:t,name:"src",value:b.mp4,index:d})&&(t.type="video/mp4",e.appendChild(t));g({target:y,name:"src",value:b.webm,index:d})&&(y.type="video/webm",e.appendChild(y));g({target:z,name:"src",value:b.ogg,index:d})&&(z.type="video/ogg",e.appendChild(z));if(t=m(b.flashFallback)?u.flashFallback:"array"===l(b.flashFallback)?m(b.flashFallback[d])?
u.flashFallback:b.flashFallback[d]:b.flashFallback)A.setAttribute("name","allowfullscreen"),A.setAttribute("value",!0),B.setAttribute("name","allowscriptaccess"),B.setAttribute("value","always"),C.setAttribute("name","flashvars"),m(b.swf)||g({target:k,name:"data",value:b.swf,index:d}),g({target:k,name:"width",value:b.width,index:d}),g({target:k,name:"height",value:b.height,index:d}),e.appendChild(k),k.setAttribute("type","application/x-shockwave-flash"),k.appendChild(A),k.appendChild(B),g({target:C,
name:"value",value:b.mp4,prefix:"file=",index:d})&&k.appendChild(C);this.players.push(e);this.elements.push(D[d]);this.isActive.push(!1);this.length++}else throw Error("Must pass in parameters to create video element.");}return this}var l=function(a){return Object.prototype.toString.call(a).replace(/^\[object (.+)\]$/,"$1").toLowerCase()},m=function(a){return"undefined"===l(a)},g=function(a){var c=!0;m(a.value)||!1===a.value?c=!1:"array"===l(a.value)?m(a.value[a.index])?c=!1:a.target.setAttribute(a.name,
(a.prefix||"")+a.value[a.index]):a.target.setAttribute(a.name,a.value);return c},h={video:p.createElement("video"),source:p.createElement("source"),object:p.createElement("object"),param:p.createElement("param")},u={preload:"auto",controls:"controls",autoplay:!1,flashFallback:!0},q=function(a){this.isActive[a]&&(this.players[a].parentNode.replaceChild(this.elements[a],this.players[a]),this.isActive[a]=!1);return this},r=function(a){this.isActive[a]||(this.elements[a].parentNode.replaceChild(this.players[a],
this.elements[a]),this.isActive[a]=!0);return this},v=function(a,c){if(a)switch(l(a)){case "number":c?r.call(this,a):q.call(this,a);break;case "array":for(var b=a.length;b--;)if("number"===l(b))c?r.call(this,b):q.call(this,b);else throw Error("Value passed in is not of valid type, must be an array of indexes.");break;default:throw Error("Value passed in is not of valid type, must be an index.");}else for(b=this.length;b--;)c?r.call(this,b):q.call(this,b);return this},n=function(a,c){switch(l(a)){case "number":return c?
this.elements[a]:this.players[a];case "string":for(var b,f=this.length;f--;)if(this.players[f].getAttribute("id")===a){b=c?this.elements[f]:this.players[f];break}return b;case "array":b=[];for(var f=0,g=a.length;f<g;f++)c?b.push(n.call(this,a[f])):b.push(n.call(this,a[f],!0));return b;case "undefined":return c?this.elements:this.players;default:throw Error("Invalid parameter passed. Can be either the index (integer), id (string), or an array of either indices of ids")["break"];}},w=function(a){switch(l(a)){case "number":return this.isActive[a];
case "string":for(var c,b=this.length;b--;)if(this.players[b].getAttribute("id")===a){c=this.isActive[b];break}return c;case "array":c=[];for(var b=0,f=a.length;b<f;b++)c.push(w.call(this,a[b]));return c;case "htmldivelement":for(b=this.length;b--;)if(this.players[b]===a){c=this.isActive[b];break}return c;case "undefined":return this.isActive;default:throw Error("Invalid parameter passed. Can be either the index (integer), id (string), or an array of either indices of ids")["break"];}};s.prototype=
{active:function(a){return w.call(this,a)},add:function(a){return v.call(this,a,!0)},element:function(a){return n.call(this,a,!0)},player:function(a){return n.call(this,a)},remove:function(a){return v.call(this,a,!1)}};x.VideoPlease=s})(window,document);
